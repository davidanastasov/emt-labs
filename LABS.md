# ЕМТ Лабораториски 2025

Код од аудиториски вежби: [https://gitlab.finki.ukim.mk/emc/emc-2025](https://gitlab.finki.ukim.mk/emc/emc-2025)

## Лаб 01

Потребно е да се изработи еден модул од апликација за изнајмување на книги од одредена библиотека, односно модулот кој би го користел корисник со role librarian, кој би имал неколку привилегии:

- Да додава нови книги кои може да се изнајмат

- Да брише книги кои повеќе не се во добра состојба и нема да се изнајмуваат

- Да изменува одреден запис за книга

- Да обележи одредена книга како изнајмена

За оваа лабораториска вежба потребно е да креирате соодветна Spring Boot апликација, односно API. Во однос на базата на податоци, потребно е да користите H2 база.

Во рамки на апликацијата се чуваат следните податоци за книгите: id (Long), name (String), category (enum), author (Author), availableCopies (Integer).

Категоријата на книгата може да биде: NOVEL, THRILLER, HISTORY, FANTASY, BIOGRAPHY, CLASSICS, DRAMA.

За секој автор пак се чуваат податоците: id (Long), name (String), surname (String), country (Country).

За секоја земја се чуваат податоците: id (Long), name (String), continent (String).

Користејќи слоевита архитектура треба да се дефинираат соодветни контролери, сервиси и репозиториуми.

Дополнително, со помош на SwaggerUI потребно е да прикажете успешно извршување на API повиците.

### Дополнително барање

- Да се имплементираат репозиториуми и сервиси за преостанатите ентитети
- Да се додаде нов ентитет за изнајмување на книга
  - Ентитетот ќе содржи име од кој корисник е изнајмена книгата и референца до книгата. 
  - Да се изменат контролерот и сервисот за изнајмување на книга да го користи новиот ентитет.
- Да се додаде репозиториум, серис и ендпоинт за добивање на листа на изнајмувања за дадена книга. `/api/books/{id}/rentals`

## Лаб 02

Во втората лабораториска вежба треба да се надгради апликацијата за изнајмување на книги со подобра архитектура и додадени функционалности. Креирајте соодвтетни сервиси и контролери за сите ентитети во апликацијата и притоа додадете:

1. Домен слој
   - сите ентитети од вашата апликација преместете ги во домен слојот (книга, автор, земја, категорија)


2. DTO слој
   - Креирајте Create и Update record DTO-a за секој модел од доменот соодветно
   - искористете ги овие DTO-a за комуникација со API-то и избегнете користење на ентитетите директно во контролерите


3. Application Services и Domain Services
   - додадете аппликациски сервиси за секое DTO што овозможуваат комуникација помеѓу контролерите и доменскиот слој
   - преместете ги доменски сервиси (сервисите што управуваат со ентитетите) во соодветен домен сервисен слој


4. Spring Security
   - овозможете најава на апликацијата
   - корисниците можат да имаат улога User или Librarian
   - креирајте соодветни DTO-a за најава и регистрација


5. Анотации со Springdoc OpenAPI
   - додадете соодветни анотации во контролерите користејќи го Springdoc OpenAPI
   - секој endpoint треба да биде документиран со @Operation анотација која ќе обезбеди краток опис и целосна документација за секој API повик


6. Имплементација на wishlist функционалност
   - овозможете корисниците да додаваат книги во својата листа на желби и да ја прегледуваат пред изнајмување
   - корисникот може да додаде книга во листата само ако има достапни копии
   - ако корисникот се обиде да додаде книга без достапни копии, прикажете соодветна порака
   - oвозможете корисникот да ги изнајми сите книги од листата на желби со една акција, при што бројот на достапни копии ќе се намали за секоја изнајмена книга

### Дополнително барање

- Да се додаде endpoint за најчесто изнајмувана книга
- Да се додаде endpoint за најчесто изнајмуван автор
- Да се додаде endpoint за корисник кој има најмногу изнајмено книги

## Лаб 03

Во третата лабораториска вежба треба да се надгради апликацијата за изнајмување на книги од претходните две лабораториски вежби со дополнителни функционалности.

1. Најнапред, заменете ја посточеката H2 база на податоци со PostgreSQL база на податоци која ќе ја подигнете со помош на Docker контејнер.


2. Потоа, дефинирајте иницијализирачка SQL скрипта во која ќе ги дефинирате потребните DDL операции за да ги креирате табелите во базата на податоци.


3. Следно, дефинирајте endpoint /api/books/by-author којшто ќе го враќа бројот на книги по автор. При имплементацијата на оваа функционалност искористете materialized view во рамките на базата на податоци којшто ќе се ажурира на секој час.


4. Исто така, дефинирајте endpoint /api/authors/by-country којшто ќе го враќа бројот на автори по земја. Идентично, за оваа функционалност искористете materialized view којшто ќе се ажурира при секое додавање/менување/бришење на автор во базата на податоци. Оваа функционалност треба да се реализира со користење на events и listeners.


5. Да се имплементира endpoint /api/authors/names којшто ќе ги враќа името и презимето на секој од авторите во рамките на базата на податоци. За оваа цел искористете projection.


6. Со помош на entity graph овозможете при повлекувањето на корсниците од базата на податоци да не се повлекува нивната „листа со желби“ (wishlist), а останатите атрибути да го задржат default-ното однесување.


7. Заменете ја постоечката автентикација и авторизација со имплементација базирана на JSON Web Token (JWT). Исто така, ако во некоја од имплементациите на endpoints корисникот го праќате како параметар (query parameter, path variable, etc.), променете го тоа така што корисникот ќе го идентификувате единствено според токен испратен во заглавјето на request-от.
